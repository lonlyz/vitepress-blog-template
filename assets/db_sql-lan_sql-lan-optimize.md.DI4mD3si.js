import{_ as e,c as s,ai as t,o as n}from"./chunks/framework.BrYByd3F.js";const u=JSON.parse('{"title":"SQL语言 - SQL语句优化","description":"","frontmatter":{},"headers":[],"relativePath":"db/sql-lan/sql-lan-optimize.md","filePath":"db/sql-lan/sql-lan-optimize.md","lastUpdated":1737706346000}'),i={name:"db/sql-lan/sql-lan-optimize.md"};function l(p,a,o,r,d,h){return n(),s("div",null,a[0]||(a[0]=[t(`<h1 id="sql语言-sql语句优化" tabindex="-1">SQL语言 - SQL语句优化 <a class="header-anchor" href="#sql语言-sql语句优化" aria-label="Permalink to &quot;SQL语言 - SQL语句优化&quot;">​</a></h1><blockquote><p>最后，再总结一些SQL语句的优化建议。@pdai</p></blockquote><h2 id="负向查询不能使用索引" tabindex="-1">负向查询不能使用索引 <a class="header-anchor" href="#负向查询不能使用索引" aria-label="Permalink to &quot;负向查询不能使用索引&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where id not in (1,3,4);</span></span></code></pre></div><p>应该修改为:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where id in (2,5,6);</span></span></code></pre></div><h2 id="前导模糊查询不能使用索引" tabindex="-1">前导模糊查询不能使用索引 <a class="header-anchor" href="#前导模糊查询不能使用索引" aria-label="Permalink to &quot;前导模糊查询不能使用索引&quot;">​</a></h2><p>如:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where name like &#39;%zhangsan&#39;</span></span></code></pre></div><p>非前导则可以:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where name like &#39;zhangsan%&#39;</span></span></code></pre></div><p>建议可以考虑使用 <code>Lucene</code> 等全文索引工具来代替频繁的模糊查询。</p><h2 id="数据区分不明显的不建议创建索引" tabindex="-1">数据区分不明显的不建议创建索引 <a class="header-anchor" href="#数据区分不明显的不建议创建索引" aria-label="Permalink to &quot;数据区分不明显的不建议创建索引&quot;">​</a></h2><p>如 user 表中的性别字段，可以明显区分的才建议创建索引，如身份证等字段。</p><h2 id="字段的默认值不要为-null" tabindex="-1">字段的默认值不要为 null <a class="header-anchor" href="#字段的默认值不要为-null" aria-label="Permalink to &quot;字段的默认值不要为 null&quot;">​</a></h2><p>这样会带来和预期不一致的查询结果。</p><h2 id="在字段上进行计算不能命中索引" tabindex="-1">在字段上进行计算不能命中索引 <a class="header-anchor" href="#在字段上进行计算不能命中索引" aria-label="Permalink to &quot;在字段上进行计算不能命中索引&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where FROM_UNIXTIME(create_time) &lt; CURDATE();</span></span></code></pre></div><p>应该修改为:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where create_time &lt; FROM_UNIXTIME(CURDATE());</span></span></code></pre></div><h2 id="最左前缀问题" tabindex="-1">最左前缀问题 <a class="header-anchor" href="#最左前缀问题" aria-label="Permalink to &quot;最左前缀问题&quot;">​</a></h2><p>如果给 user 表中的 username pwd 字段创建了复合索引那么使用以下SQL 都是可以命中索引:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select username from user where username=&#39;zhangsan&#39; and pwd =&#39;axsedf1sd&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>select username from user where pwd =&#39;axsedf1sd&#39; and username=&#39;zhangsan&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>select username from user where username=&#39;zhangsan&#39;</span></span></code></pre></div><p>但是使用</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select username from user where pwd =&#39;axsedf1sd&#39;</span></span></code></pre></div><p>是不能命中索引的。</p><h2 id="如果明确知道只有一条记录返回" tabindex="-1">如果明确知道只有一条记录返回 <a class="header-anchor" href="#如果明确知道只有一条记录返回" aria-label="Permalink to &quot;如果明确知道只有一条记录返回&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where username=&#39;zhangsan&#39; limit 1</span></span></code></pre></div><p>可以提高效率，可以让数据库停止游标移动。</p><h2 id="不要让数据库帮我们做强制类型转换" tabindex="-1">不要让数据库帮我们做强制类型转换 <a class="header-anchor" href="#不要让数据库帮我们做强制类型转换" aria-label="Permalink to &quot;不要让数据库帮我们做强制类型转换&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where telno=18722222222</span></span></code></pre></div><p>这样虽然可以查出数据，但是会导致全表扫描。</p><p>需要修改为</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select name from user where telno=&#39;18722222222&#39;</span></span></code></pre></div><h2 id="如果需要进行-join-的字段两表的字段类型要相同" tabindex="-1">如果需要进行 join 的字段两表的字段类型要相同 <a class="header-anchor" href="#如果需要进行-join-的字段两表的字段类型要相同" aria-label="Permalink to &quot;如果需要进行 join 的字段两表的字段类型要相同&quot;">​</a></h2><p>不然也不会命中索引。</p><h1 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h1><ul><li><a href="https://github.com/realpdai/JCSprout/blob/master/MD/SQL-optimization.md" target="_blank" rel="noreferrer">https://github.com/realpdai/JCSprout/blob/master/MD/SQL-optimization.md</a></li><li><a href="http://blog.csdn.net/u010003835/article/details/54381080" target="_blank" rel="noreferrer">http://blog.csdn.net/u010003835/article/details/54381080</a></li><li><ul><li><a href="https://mp.weixin.qq.com/s/BMQC2oJlhLoeBDtveXgHpw" target="_blank" rel="noreferrer">MySQL 大表优化方案在新窗口打开</a></li></ul></li></ul><p>本文转自 <a href="https://pdai.tech" target="_blank" rel="noreferrer">https://pdai.tech</a>，如有侵权，请联系删除。</p>`,39)]))}const b=e(i,[["render",l]]);export{u as __pageData,b as default};
